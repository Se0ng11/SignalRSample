@{
    ViewBag.Title = "Instant Database Changes Using SignalR Demo";
}

<div class="row">
    <h1 style="color: green">Instant Database Changes Using SignalR</h1>
    <div class="col-md-12">
        <div id="divStudent"></div>

        <div id="divLine"></div>

    </div>
</div>
@section Scripts{
    <script src="@Url.Content("~/Scripts/jquery.signalR-2.2.2.js")"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="@Url.Content("~/signalr/hubs")"></script>
    <script type="text/javascript">
        $(function () {
            // Create a proxy to signalr hub on web server. It reference the hub.
            GenerateTimeAndLine();
            var notifications = $.connection.studentHub;

            // Notify to client with the recent updates from hub that broadcast messages.
            notifications.client.updateStudentInformation = function (serverResponse) {
                //alert('changes triggered by ' + serverResponse + ' operation');
                getStudentInformation()

            };

            // Connect to signalr hub
            $.connection.hub.start().done(function () {
                getStudentInformation();
            }).fail(function (error) {
                alert(error);
            });
        });


        function getStudentInformation() {
            var model = $('#divStudent');
            $.ajax({
                url: '@Url.Content("~/home/SendStudentNotification")',
                contentType: 'application/html ; charset:utf-8',
                type: 'GET',
                dataType: 'html'
            }).success(function (result) {
                model.empty().append(result);
            }).error(function () {

            });
        }

        function GenerateTimeAndLine() {
            var time = 26;
            var line = 49;

            for (var i = 0; i < time.length - 1; i++) {
                console.log(('0' + i).slice(-2));
            }
        }
    </script>
}